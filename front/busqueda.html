<!DOCTYPE html>
<html lang="es" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√∫squeda de Incidencias</title>

    <!-- Tailwind + DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .clickable-stat:hover {
        cursor: pointer;
        transform: translateY(-2px);
        transition: all 0.2s ease;
      }
      .stat-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #f3f4f6;
      }
      .stat-title {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .stat-value {
        font-size: 1.5rem;
        font-weight: bold;
      }
    </style>
  </head>

  <body class="bg-base-300 h-screen flex flex-col">
    <!-- Header -->
    <header class="navbar bg-orange-400 text-white px-6 h-16 flex-none">
      <div class="flex-1">
        <h1 class="text-2xl font-bold">Incidencias: B√∫squeda</h1>
      </div>
      <div class="flex-none text-3xl font-bold">H</div>
    </header>

    <main class="flex flex-1 overflow-hidden">
      <aside
        class="w-64 bg-base-100 p-6 shadow-md flex flex-col h-full justify-between"
      >
        <h2 class="text-xl font-semibold mb-6">Men√∫</h2>
        <div class="flex flex-col space-y-3 flex-grow">
          <button class="btn bg-orange-400 hover:bg-yellow-500 text-black font-semibold w-full">
            Iniciar Despido
          </button>
          <button class="btn bg-orange-400 hover:bg-yellow-500 text-black font-semibold w-full">
            Crear Incidencia
          </button>
          <button class="btn btn-neutral w-full">Buscar Incidencia</button>
        </div>
        <div
          class="mt-auto text-sm text-center text-gray-500 pt-4 border-t border-gray-300"
        >
          Incidencias y Despidos
        </div>
      </aside>

      <!-- Secci√≥n principal de b√∫squeda -->
      <section class="flex-1 overflow-auto p-8">
        <!-- Estad√≠sticas -->
        <div class="card bg-base-100 shadow-xl mb-6">
          <div class="card-body">
            <h2 class="card-title text-lg font-semibold">Total de Incidencias</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
              <div class="stat-container clickable-stat" onclick="filtrarPorTipo('todos')">
                <div class="stat-title">Total de incidencias</div>
                <div class="stat-value" id="total-incidencias">8</div>
              </div>
              <div class="stat-container clickable-stat" onclick="filtrarPorTipo('retardo')">
                <div class="stat-title">Retardos</div>
                <div class="stat-value" id="total-retardos">4</div>
              </div>
              <div class="stat-container clickable-stat" onclick="filtrarPorTipo('enfermedad')">
                <div class="stat-title">Enfermedad</div>
                <div class="stat-value" id="total-enfermedad">2</div>
              </div>
              <div class="stat-container clickable-stat" onclick="filtrarPorTipo('despido')">
                <div class="stat-title">Despidos</div>
                <div class="stat-value" id="total-despidos">2</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Filtros y tabla -->
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <!-- Pesta√±as de filtro -->
            <div class="tabs tabs-boxed bg-base-200 w-fit mb-4" id="filtro-estado">
              <a class="tab tab-active" onclick="filtrarPorEstado('todos')">All</a> 
              <a class="tab" onclick="filtrarPorEstado('incompleto')">Incomplete</a> 
              <a class="tab" onclick="filtrarPorEstado('atrasado')">Overdue</a> 
              <a class="tab" onclick="filtrarPorEstado('en-progreso')">Ongoing</a> 
              <a class="tab" onclick="filtrarPorEstado('finalizado')">Finished</a>
            </div>

            <!-- Tabla de incidencias -->
            <div class="overflow-x-auto">
              <table class="table table-zebra w-full" id="tabla-incidencias">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Acumulado</th>
                    <th>Acci√≥n</th>
                  </tr>
                </thead>
                <tbody id="cuerpo-tabla">
                  <!-- Las filas se generar√°n din√°micamente con JavaScript -->
                </tbody>
              </table>
            </div>

            <!-- Botones de Reporte -->
            <div class="card-actions justify-end mt-6 space-x-4">
              <button class="btn btn-neutral" onclick="mostrarModalReporteDespidos()">Reporte Despidos</button>
              <button class="btn btn-neutral" onclick="mostrarModalReporteGeneral()">Generar Reporte</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Modal para detalles de incidencia - MEJORADO -->
    <input type="checkbox" id="modal-detalles" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box max-w-2xl">
        <h3 class="font-bold text-lg mb-4" id="modal-titulo">Detalles: #ORDY008</h3>
        <div class="py-4" id="modal-contenido">
          <!-- Contenido din√°mico -->
        </div>
        
        <div class="modal-action">
          <label for="modal-detalles" class="btn">Cerrar</label>
        </div>
      </div>
    </div>

    <!-- Modal para editar incidencia - NUEVO -->
    <input type="checkbox" id="modal-editar" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box max-w-3xl">
        <h3 class="font-bold text-lg mb-4">Editor Incidencia</h3>
        <div class="py-4">
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <label class="label">
                <span class="label-text font-semibold">Tipo de Incidencia</span>
              </label>
              <select class="select select-bordered w-full">
                <option>Retardo</option>
                <option>Enfermedad</option>
                <option>Despido</option>
              </select>
            </div>
            <div>
              <label class="label">
                <span class="label-text font-semibold">Estado</span>
              </label>
              <select class="select select-bordered w-full">
                <option>Incomplete</option>
                <option>Overdue</option>
                <option>Ongoing</option>
                <option>Finished</option>
              </select>
            </div>
          </div>
          
          <div class="mb-4">
            <label class="label">
              <span class="label-text font-semibold">Acumulado</span>
            </label>
            <input type="number" class="input input-bordered w-full" value="1">
          </div>
          
          <div class="mb-4">
            <label class="label">
              <span class="label-text font-semibold">Descripci√≥n</span>
            </label>
            <textarea class="textarea textarea-bordered w-full h-32" placeholder="Ingrese la descripci√≥n de la incidencia">Lleg√≥ 15 minutos tarde sin justificaci√≥n</textarea>
          </div>
        </div>
        
        <div class="modal-action">
          <label for="modal-editar" class="btn">Cancelar</label>
          <button class="btn btn-primary" onclick="guardarCambios()">Guardar Cambios</button>
        </div>
      </div>
    </div>

    <!-- Modal para confirmar eliminaci√≥n - MEJORADO -->
    <input type="checkbox" id="modal-eliminar" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box">
        <h3 class="font-bold text-lg">Confirmar Eliminaci√≥n</h3>
        <div class="py-4">
          <p id="texto-eliminar">¬øEst√° seguro de eliminar la incidencia?</p>
        </div>
        <div class="modal-action">
          <label for="modal-eliminar" class="btn">Cancelar</label>
          <button class="btn btn-error" id="btn-confirmar-eliminar">Eliminar</button>
        </div>
      </div>
    </div>

    <!-- Modal para confirmar generaci√≥n de reporte general - MEJORADO -->
    <input type="checkbox" id="modal-reporte-general" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box max-w-3xl">
        <h3 class="font-bold text-lg">Confirmar Generaci√≥n de Reporte</h3>
        <div class="py-4">
          <p>¬øEst√° seguro de que desea generar el reporte general de incidencias?</p>
          <p class="mt-2">Se generar√° un archivo PDF con todas las incidencias registradas en el sistema.</p>
          
          <div class="overflow-x-auto mt-4">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Fecha</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="font-semibold">#ORDY011</td>
                  <td>Carlos Mendoza</td>
                  <td>20 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY010</td>
                  <td>Ana L√≥pez</td>
                  <td>19 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY009</td>
                  <td>Roberto Silva</td>
                  <td>18 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY008</td>
                  <td>Esther Klein</td>
                  <td>17 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY007</td>
                  <td>Denise Kuhn</td>
                  <td>10 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY006</td>
                  <td>Clint Hoppe</td>
                  <td>16 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY005</td>
                  <td>Darin Deckow</td>
                  <td>16 Dec 2024</td>
                </tr>
                <tr>
                  <td class="font-semibold">#ORDY004</td>
                  <td>Mar√≠a Gonz√°lez</td>
                  <td>15 Dec 2024</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="mt-4">
            <h4 class="font-semibold">Acumulado</h4>
            <div class="flex space-x-4 mt-2">
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">1</div>
              </div>
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">2</div>
              </div>
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">1</div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-action">
          <label for="modal-reporte-general" class="btn">Cancelar</label>
          <button class="btn btn-neutral" onclick="generarReporteGeneral()">Generar Reporte</button>
        </div>
      </div>
    </div>

    <!-- Modal para confirmar generaci√≥n de reporte de despidos - MEJORADO -->
    <input type="checkbox" id="modal-reporte-despidos" class="modal-toggle" />
    <div class="modal">
      <div class="modal-box max-w-3xl">
        <h3 class="font-bold text-lg">Confirmar Generaci√≥n de Reporte</h3>
        <div class="py-4">
          <p>¬øEst√° seguro de que desea generar el reporte de despidos?</p>
          <p class="mt-2">Se generar√° un archivo PDF con todos los despidos registrados en el sistema.</p>
          
          <div class="overflow-x-auto mt-4">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Fecha</th>
                  <th>Tipo</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Clint Hoppe</td>
                  <td>16 Dec 2024</td>
                  <td>Enfermedad</td>
                </tr>
                <tr>
                  <td>Darin Deckow</td>
                  <td>16 Dec 2024</td>
                  <td>Despido</td>
                </tr>
                <tr>
                  <td>Mar√≠a Gonz√°lez</td>
                  <td>15 Dec 2024</td>
                  <td>Despido</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="mt-4">
            <h4 class="font-semibold">Acumulado</h4>
            <div class="flex space-x-4 mt-2">
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">1</div>
              </div>
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">2</div>
              </div>
              <div class="stat bg-base-200 rounded-lg p-4">
                <div class="stat-value text-lg">1</div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-action">
          <label for="modal-reporte-despidos" class="btn">Cancelar</label>
          <button class="btn btn-neutral" onclick="generarReporteDespidos()">Generar Reporte</button>
        </div>
      </div>
    </div>

    <script>
      // Datos actualizados con m√°s registros
      const incidencias = [
        {
          id: "#ORDY011",
          nombre: "Carlos Mendoza",
          fecha: "20 Dec 2024",
          tipo: "Retardo",
          acumulado: 1,
          estado: "incompleto",
          area: "Log√≠stica",
          descripcion: "Lleg√≥ 20 minutos tarde por tr√°fico",
          antecedentes: "Primer retardo"
        },
        {
          id: "#ORDY010",
          nombre: "Ana L√≥pez",
          fecha: "19 Dec 2024",
          tipo: "Enfermedad",
          acumulado: 1,
          estado: "finalizado",
          area: "Recursos Humanos",
          descripcion: "Ausencia por gripe",
          antecedentes: "Sin antecedentes previos"
        },
        {
          id: "#ORDY009",
          nombre: "Roberto Silva",
          fecha: "18 Dec 2024",
          tipo: "Retardo",
          acumulado: 3,
          estado: "atrasado",
          area: "Ventas",
          descripcion: "Lleg√≥ 30 minutos tarde sin aviso",
          antecedentes: "2 retardos previos en el mes"
        },
        {
          id: "#ORDY008",
          nombre: "Esther Klein",
          fecha: "17 Dec 2024",
          tipo: "Retardo",
          acumulado: 1,
          estado: "incompleto",
          area: "Ventas",
          descripcion: "Lleg√≥ 15 minutos tarde sin justificaci√≥n",
          antecedentes: "2 retardos previos en el mes"
        },
        {
          id: "#ORDY007",
          nombre: "Denise Kuhn",
          fecha: "10 Dec 2024",
          tipo: "Retardo",
          acumulado: 2,
          estado: "finalizado",
          area: "Administraci√≥n",
          descripcion: "Retardo sin justificaci√≥n",
          antecedentes: "Sin antecedentes previos"
        },
        {
          id: "#ORDY006",
          nombre: "Clint Hoppe",
          fecha: "16 Dec 2024",
          tipo: "Enfermedad",
          acumulado: 1,
          estado: "finalizado",
          area: "Operaciones",
          descripcion: "Ausencia por enfermedad",
          antecedentes: "Sin antecedentes previos"
        },
        {
          id: "#ORDY005",
          nombre: "Darin Deckow",
          fecha: "16 Dec 2024",
          tipo: "Despido",
          acumulado: "-",
          estado: "en-progreso",
          area: "Ventas",
          descripcion: "Despido por bajo rendimiento",
          antecedentes: "Varias advertencias previas"
        },
        {
          id: "#ORDY004",
          nombre: "Mar√≠a Gonz√°lez",
          fecha: "15 Dec 2024",
          tipo: "Despido",
          acumulado: "-",
          estado: "finalizado",
          area: "Contabilidad",
          descripcion: "Despido por faltas repetidas",
          antecedentes: "5 faltas en el √∫ltimo mes"
        }
      ];

      // Variables para filtros
      let filtroTipoActual = 'todos';
      let filtroEstadoActual = 'todos';
      let incidenciaAEliminar = null;
      let incidenciaAEditar = null;

      // Inicializar la tabla al cargar la p√°gina
      document.addEventListener('DOMContentLoaded', function() {
        actualizarEstadisticas();
        renderizarTabla();
        
        // Configurar eventos para modales
        document.getElementById('btn-confirmar-eliminar').addEventListener('click', confirmarEliminar);
      });

      // Funci√≥n para actualizar las estad√≠sticas
      function actualizarEstadisticas() {
        const total = incidencias.length;
        const retardos = incidencias.filter(i => i.tipo === 'Retardo').length;
        const enfermedad = incidencias.filter(i => i.tipo === 'Enfermedad').length;
        const despidos = incidencias.filter(i => i.tipo === 'Despido').length;

        document.getElementById('total-incidencias').textContent = total;
        document.getElementById('total-retardos').textContent = retardos;
        document.getElementById('total-enfermedad').textContent = enfermedad;
        document.getElementById('total-despidos').textContent = despidos;
      }

      // Funci√≥n para renderizar la tabla con filtros aplicados
      function renderizarTabla() {
        const cuerpoTabla = document.getElementById('cuerpo-tabla');
        cuerpoTabla.innerHTML = '';

        // Aplicar filtros
        let incidenciasFiltradas = incidencias;
        
        if (filtroTipoActual !== 'todos') {
          incidenciasFiltradas = incidenciasFiltradas.filter(i => 
            i.tipo.toLowerCase() === filtroTipoActual
          );
        }
        
        if (filtroEstadoActual !== 'todos') {
          incidenciasFiltradas = incidenciasFiltradas.filter(i => 
            i.estado === filtroEstadoActual
          );
        }

        // Generar filas de la tabla
        incidenciasFiltradas.forEach(incidencia => {
          const fila = document.createElement('tr');
          
          // Determinar clase del badge seg√∫n el tipo
          let badgeClass = 'badge ';
          switch(incidencia.tipo) {
            case 'Retardo':
              badgeClass += 'badge-warning';
              break;
            case 'Enfermedad':
              badgeClass += 'badge-info';
              break;
            case 'Despido':
              badgeClass += 'badge-error';
              break;
            default:
              badgeClass += 'badge-neutral';
          }

          fila.innerHTML = `
            <td class="font-semibold">${incidencia.id}</td>
            <td>${incidencia.nombre}</td>
            <td>${incidencia.fecha}</td>
            <td>
              <span class="${badgeClass}">${incidencia.tipo}</span>
            </td>
            <td>${incidencia.acumulado}</td>
            <td>
              <div class="flex space-x-2">
                <button class="btn btn-sm btn-circle btn-success" onclick="marcarCompletado('${incidencia.id}')">
                  ‚úì
                </button>
                <button class="btn btn-sm btn-circle btn-warning" onclick="ponerEnEspera('${incidencia.id}')">
                  üí§
                </button>
                <div class="dropdown dropdown-end">
                  <div tabindex="0" role="button" class="btn btn-sm btn-circle">
                    ...
                  </div>
                  <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="verDetalles('${incidencia.id}')">Ver detalles</a></li>
                    <li><a onclick="editarIncidencia('${incidencia.id}')">Editar</a></li>
                    <li><a onclick="mostrarModalEliminar('${incidencia.id}')">Eliminar</a></li>
                  </ul>
                </div>
              </div>
            </td>
          `;
          
          cuerpoTabla.appendChild(fila);
        });

        // Si no hay resultados, mostrar mensaje
        if (incidenciasFiltradas.length === 0) {
          const filaVacia = document.createElement('tr');
          filaVacia.innerHTML = `
            <td colspan="6" class="text-center py-4 text-gray-500">
              No se encontraron incidencias con los filtros aplicados
            </td>
          `;
          cuerpoTabla.appendChild(filaVacia);
        }
      }

      // Funciones de filtrado
      function filtrarPorTipo(tipo) {
        filtroTipoActual = tipo;
        renderizarTabla();
        
        // Actualizar pesta√±as de estado
        document.querySelectorAll('#filtro-estado .tab').forEach(tab => {
          tab.classList.remove('tab-active');
        });
        document.querySelector('#filtro-estado .tab').classList.add('tab-active');
        filtroEstadoActual = 'todos';
      }

      function filtrarPorEstado(estado) {
        filtroEstadoActual = estado;
        renderizarTabla();
        
        // Actualizar pesta√±as activas
        document.querySelectorAll('#filtro-estado .tab').forEach(tab => {
          tab.classList.remove('tab-active');
        });
        event.target.classList.add('tab-active');
      }

      // Funciones de acci√≥n para los botones
      function marcarCompletado(id) {
        const incidencia = incidencias.find(i => i.id === id);
        if (incidencia) {
          incidencia.estado = 'finalizado';
          alert(`Incidencia ${id} marcada como completada`);
          renderizarTabla();
        }
      }

      function ponerEnEspera(id) {
        const incidencia = incidencias.find(i => i.id === id);
        if (incidencia) {
          incidencia.estado = 'en-progreso';
          alert(`Incidencia ${id} puesta en espera`);
          renderizarTabla();
        }
      }

      function verDetalles(id) {
        const incidencia = incidencias.find(i => i.id === id);
        if (incidencia) {
          document.getElementById('modal-titulo').textContent = `Detalles: ${id}`;
          document.getElementById('modal-contenido').innerHTML = `
            <div class="space-y-4">
              <div><strong>Nombre:</strong> ${incidencia.nombre}</div>
              <div><strong>Fecha:</strong> ${incidencia.fecha}</div>
              <div><strong>Tipo:</strong> ${incidencia.tipo}</div>
              <div><strong>Estado:</strong> ${incidencia.estado}</div>
              <div><strong>Acumulado:</strong> ${incidencia.acumulado}</div>
              <div><strong>√Årea:</strong> ${incidencia.area}</div>
              <div><strong>Descripci√≥n:</strong> ${incidencia.descripcion}</div>
              <div><strong>Antecedentes:</strong> ${incidencia.antecedentes}</div>
            </div>
            <div class="divider"></div>
            <div class="flex justify-between">
              <div>
                <h4 class="font-bold mb-2">Despidos</h4>
                <div>1</div>
              </div>
              <div>
                <h4 class="font-bold mb-2">Acumulado</h4>
                <div class="flex space-x-4">
                  <span>1</span>
                  <span>2</span>
                  <span>1</span>
                </div>
              </div>
              <div>
                <h4 class="font-bold mb-2">Acci√≥n</h4>
                <div class="flex space-x-2">
                  <button class="btn btn-xs btn-outline">Ver detalles</button>
                  <button class="btn btn-xs btn-outline">Editar</button>
                  <button class="btn btn-xs btn-outline btn-error">Eliminar</button>
                </div>
              </div>
            </div>
          `;
          document.getElementById('modal-detalles').checked = true;
        }
      }

      function editarIncidencia(id) {
        const incidencia = incidencias.find(i => i.id === id);
        if (incidencia) {
          incidenciaAEditar = id;
          document.getElementById('modal-editar').checked = true;
        }
      }

      function guardarCambios() {
        if (incidenciaAEditar) {
          alert(`Cambios guardados para la incidencia ${incidenciaAEditar}`);
          document.getElementById('modal-editar').checked = false;
          incidenciaAEditar = null;
        }
      }

      function mostrarModalEliminar(id) {
        const incidencia = incidencias.find(i => i.id === id);
        if (incidencia) {
          incidenciaAEliminar = id;
          document.getElementById('texto-eliminar').textContent = 
            `¬øEst√° seguro de eliminar la incidencia ${id} de ${incidencia.nombre}?`;
          document.getElementById('modal-eliminar').checked = true;
        }
      }

      function confirmarEliminar() {
        if (incidenciaAEliminar) {
          const index = incidencias.findIndex(i => i.id === incidenciaAEliminar);
          if (index !== -1) {
            incidencias.splice(index, 1);
            actualizarEstadisticas();
            renderizarTabla();
            alert(`Incidencia ${incidenciaAEliminar} eliminada correctamente`);
            document.getElementById('modal-eliminar').checked = false;
            incidenciaAEliminar = null;
          }
        }
      }

      // Funciones para mostrar modales de reporte
      function mostrarModalReporteDespidos() {
        document.getElementById('modal-reporte-despidos').checked = true;
      }

      function mostrarModalReporteGeneral() {
        document.getElementById('modal-reporte-general').checked = true;
      }

      // Funciones para generar reportes
      function generarReporteDespidos() {
        alert('Generando reporte de despidos en PDF...');
        document.getElementById('modal-reporte-despidos').checked = false;
      }

      function generarReporteGeneral() {
        alert('Generando reporte general de incidencias en PDF...');
        document.getElementById('modal-reporte-general').checked = false;
      }
    </script>
  </body>
</html>